## セクション6で学んだことメモ

### パーミッションとスーパーユーザー
* マルチユーザーシステム
  * 1つのコンピュータを複数人で扱えるシステム（LinuxOSサーバへ遠隔ログイン）
    * ログインはコンピュータを誰が扱っているのか明確にするため
  * 発生する可能性がある問題
    1. 自身が作成したファイルを他人が削除してしまう
    2. 開発者の中の初心者がコンピュータに対して致命的な影響を与えてしまう
* アクセス権（パーミッション）
  * 問題点に対する対処法
    1. 自分が作ったファイルは自分しか削除できないように設定
    2. 新米エンジニアには閲覧のみ権限を設定
* フールプルーフ
  * foolproof：「間違えようのない」の意味
    * バカ、愚か者（fool）が使っても耐える、問題ない（proof）設計を目指す
      * ソフトウェア開発全体に役立つ知識
    * 例：座らないと水が出ないトイレのウォシュレット
* パーミッションを設定する単位
  * オーナー
    * Linuxで扱われる全てのファイルに読み取り権限・書き込み権限・実行権限などをもつ
  * 所有グループ
    * ファイルを所有するグループであり、そこに属するユーザーは所有するファイルに対してその他のユーザーとは異なるパーミッションをもつ
    * 多くの場合、オーナーほどではないが強いパーミッションを与えられることが多い
  * その他
    * 上記に属さないユーザーは一番弱いパーミッションを与えられることが多い

* パーミッションを確認
  * 例：fileを作成
  ```
  rukk@rukk-VirtualBox:~$ touch file
  rukk@rukk-VirtualBox:~$ ls
  file  snap  ダウンロード  テンプレート  デスクトップ  ドキュメント  ビデオ  ピクチャ  ミュージック  公開
  rukk@rukk-VirtualBox:~$ ls -l
  合計 36
  -rw-rw-r-- 1 rukk rukk  0  2月 23 13:20 file
  drwx------ 4 rukk rukk 4096  2月 18 13:19 snap
  drwxr-xr-x 2 rukk rukk 4096  1月 25 18:41 ダウンロード
  （以下、省略）
  ```
    * 1列目：パーミッション（ディレクトリにおいて以下の意味がある）
      * r（読み取り）：ディレクトリに含まれるファイル一覧の取得
      * w（書き込み）：ディレクトリの下にあるファイル・ディレクトリの作成・削除
      * x（実行）：ディレクトリをカレントディレクトリにする
        * `drwxr-xr-x`の1文字目が`d`はディレクトリを、`-rw-rw-r--`の1文字目が`-`はファイル種別を指す
        * `drwxr-xr-x`の2文字目以降は、3つごとに意味がある（パーミッションの単位ごとに表現）
          * オーナーは全てのパーミッション（rwx）をもつ
          * 所有グループ・その他は書き込み以外のパーミッション（r-x）をもつ
    * 2列目：ハードリンクのカウント
    * 3列目：オーナー
    * 4列目：所有グループ
* chmod（change mode）
  * パーミッションを変更可能でき、2つのモードがある
    * シンボルモード
      * 「誰に」「何を」「どうする」かを指定できる
        * 誰に：`u`（オーナー）、`g`（グループ）、`o`（その他のユーザー）、`a`（ugoすべて）
        * 何を：`r`（読み取り）、`w`（書き込み）、`x`（実行）
        * どうする：`+`（パーミッションの追加）、`-`（パーミッションの削除）、`=`（指定したパーミッションと等しくする）
      * 例：すべてのユーザー`a`に実行のパーミッション`x`を追加`+`
      ```
      rukk@rukk-VirtualBox:~$ touch example.sh
      rukk@rukk-VirtualBox:~$ ls -l
      合計 36
      -rw-rw-r-- 1 rukk rukk  0  2月 23 14:00 example.sh
      -rw-rw-r-- 1 rukk rukk  0  2月 23 13:20 file
      drwx------ 4 rukk rukk 4096  2月 18 13:19 snap
      （以下、省略）
      rukk@rukk-VirtualBox:~$ chmod a+x example.sh
      rukk@rukk-VirtualBox:~$ ls -l
      合計 36
      -rwxrwxr-x 1 rukk rukk  0  2月 23 14:00 example.sh
      -rw-rw-r-- 1 rukk rukk  0  2月 23 13:20 file
      drwx------ 4 rukk rukk 4096  2月 18 13:19 snap
      （以下、省略）
      ```
      * その他のユーザーのパーミッションを`rw-`にする　→　`o=rw`
      * 所有グループに属するユーザーとその他ユーザーから実行権限を削除　→ `go-x`
    * 数値モード
      * r：4
      * w：2
      * x：1
        * 例：`rwx`は「4+2+1」、`r-x`は「4+1=5」
      * 例：example.shの実行権限を全て削除
      ```
      rukk@rukk-VirtualBox:~$ ls -l
      合計 36
      -rwxrwxr-x 1 rukk rukk  0  2月 23 14:00 example.sh
      -rw-rw-r-- 1 rukk rukk  0  2月 23 13:20 file
      drwx------ 4 rukk rukk 4096  2月 18 13:19 snap
      （以下、省略）
      rukk@rukk-VirtualBox:~$ chmod 664 example.sh
      rukk@rukk-VirtualBox:~$ ls -l
      合計 36
      -rw-rw-r-- 1 rukk rukk  0  2月 23 14:00 example.sh
      -rw-rw-r-- 1 rukk rukk  0  2月 23 13:20 file
      drwx------ 4 rukk rukk 4096  2月 18 13:19 snap
      （以下、省略）
      ```
* スーパーユーザー
  * 管理者権限をもつ特別なユーザーであり、ユーザー名が「root」なので「rootユーザー」と呼ばれる
  * あらゆる操作が許可された権限をもち、システムの設定ファイルの変更やアプリのインストールが可能
  * ファイルのパーミッションの影響を受けずに全てのファイルに対して読み込み・書き込み・実行が可能
  * `su`コマンド（substitute user（代わりのユーザー） ）
    * 本来ユーザーを切り替えるためのコマンドだが主にスーパーユーザーになるために使われる
    * rootユーザーのパスワードが求められる
    * 一般ユーザーは`$`だが、スーパーユーザーは`#`になる
    * `su`でスーパーユーザーに変更すると、許可が必要なコマンドを実行できる
    ```
    rukk@rukk-VirtualBox:~$ cat /etc/shadow
    cat: /etc/shadow: 許可がありません
    rukk@rukk-VirtualBox:~$ su
    パスワード:
    root@rukk-VirtualBox:/home/rukk# cat /etc/shadow
    root:$y$j9T$UmcOAD5OuC3it.w86bdjf.$Ehk2O1EraJxW2Vr3uE59S/QiW6LV.4NQiqbQPTK04v.:19776:0:99999:7:::
    （以下、省略）
    ```
    * `exit`で一般ユーザーに戻る
  * `sudo`コマンド（substitute user do（代わりのユーザーが実行）
    * 「`sudo` 実行したいコマンド」でユーザーを切り替えなくても実行できる
    * 現在ログインしているユーザーのパスワードが必要
    ```
    rukk@rukk-VirtualBox:~$ sudo cat /etc/shadow
    root:$y$j9T$UmcOAD5OuC3it.w86bdjf.$Ehk2O1EraJxW2Vr3uE59S/QiW6LV.4NQiqbQPTK04v.:19776:0:99999:7:::
    （以下、省略）
    ```
  * `su`と`sudo`の使い分け
    * 基本的に`sudo`で済ませ、`sudo`が使えない場合に`su`を使う
      * `su`は様々なパーミッションをもち、誤操作で致命的な変更を加えないようにするため